<!DOCTYPE html>
<html lang="it">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tools & Utility - Beer Tasting Club</title>
    
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />
    
    <link rel="stylesheet" href="css/icomoon.css">

    <link rel="stylesheet" href="css/style.css">
    <link rel="manifest" href="/Beer-Tasting-Club/manifest.json">
    <meta name="theme-color" content="#f59e0b">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <link rel="icon" type="image/png" href="assets/icon-192.png">
    <link rel="apple-touch-icon" href="assets/icon-192.png">
    
    <style>
        /* GRID MENU STRUMENTI */
        .tools-grid { display: grid; grid-template-columns: 1fr; gap: 15px; margin-top: 20px; }
        
        .tool-card {
            background: #1f2937; border: 1px solid #374151; border-radius: 12px; padding: 20px;
            display: flex; align-items: center; gap: 15px; cursor: pointer;
            transition: transform 0.2s, border-color 0.2s; text-decoration: none; /* Per i link */
        }
        .tool-card:active { transform: scale(0.98); }
        .tool-card:hover { border-color: var(--primary-color); }

        .tool-icon {
            font-size: 2.5rem; color: var(--primary-color);
            background: rgba(245, 158, 11, 0.1); padding: 10px; border-radius: 50%;
        }

        .tool-info h3 { margin: 0; color: #fff; font-size: 1.1rem; }
        .tool-info p { margin: 5px 0 0 0; color: var(--text-muted); font-size: 0.9rem; }

        /* BOX GENERICO TOOL */
        .tool-container { margin-top: 20px; animation: fadeIn 0.3s ease-out; }
        .tool-box { background: #111827; padding: 15px; border-radius: 8px; border: 1px solid #374151; margin-bottom: 20px; }
        .tool-header {
            display: flex; align-items: center; gap: 10px; margin-top: 0; margin-bottom: 15px;
            color: #d1d5db; font-size: 1.1rem; border-bottom: 1px solid #374151; padding-bottom: 10px;
        }
        .tool-header span { color: var(--primary-color); }

        /* STILI CONVERTITORE */
        .conv-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }
        .conv-item { display: flex; flex-direction: column; gap: 5px; }
        .conv-item label { color: var(--text-muted); font-size: 0.8rem; font-weight: 500; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        .conv-item input {
            padding: 12px; border-radius: 6px; border: 1px solid #4b5563;
            background: #1f2937; color: white; font-size: 1rem; width: 100%; box-sizing: border-box;
        }
        .conv-item input:focus { border-color: var(--primary-color); outline: none; background: #374151; }

        /* STILI COLOR TOOL */
        #beer-glass-preview {
            width: 120px; height: 160px; margin: 20px auto;
            border: 2px solid rgba(255, 255, 255, 0.2); border-radius: 0 0 15px 15px; border-top: none;
            background-color: #f0eebc; box-shadow: 0 0 20px rgba(0, 0, 0, 0.5) inset;
            transition: background-color 0.1s; position: relative;
        }
        #beer-glass-preview::before {
            content: ''; position: absolute; top: -10px; left: 0; width: 100%; height: 20px;
            background: white; border-radius: 5px 5px 0 0; opacity: 0.9;
        }
        .color-values { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 10px; margin-bottom: 20px; }
        .color-val-box { text-align: center; background: #1f2937; padding: 10px; border-radius: 6px; border: 1px solid #374151; }
        .color-val-box label { display: block; color: var(--text-muted); font-size: 0.8rem; margin-bottom: 5px; }
        .color-val-box span { font-size: 1.2rem; font-weight: bold; color: white; }

        input[type=range] { -webkit-appearance: none; appearance: none; width: 100%; background: transparent; cursor: pointer; }
        input[type=range]::-webkit-slider-runnable-track { width: 100%; height: 10px; background: linear-gradient(to right, #f0eebc, #d5a435, #a7582e, #501113, #000000); border-radius: 5px; }
        input[type=range]::-webkit-slider-thumb { -webkit-appearance: none; appearance: none; height: 24px; width: 24px; border-radius: 50%; background: white; margin-top: -7px; box-shadow: 0 2px 5px black; border: 2px solid var(--primary-color); }
    </style>
</head>

<body>
    <div class="container">

        <div class="header-bar">
            <div id="dynamic-back-btn" class="header-link" style="cursor: pointer;">
                <span class="material-symbols-outlined">arrow_back</span> <span id="back-label">Home</span>
            </div>
            <img src="assets/logo.png" alt="Logo" class="header-logo">
        </div>

        <h2 class="text-center" id="page-title" style="margin-bottom: 5px;">Strumenti</h2>
        <p class="text-center" id="page-subtitle" style="color: var(--text-muted); font-size: 0.9em; margin-top:0;">
            Utility per Homebrewer e Giudici</p>

        <div id="view-menu">
            <div class="tools-grid">
                
                <div class="tool-card" onclick="openTool('converter')">
                    <span class="material-symbols-outlined tool-icon">calculate</span>
                    <div class="tool-info">
                        <h3>Convertitore</h3>
                        <p>Gravità, Volumi, Pressione, Temp.</p>
                    </div>
                </div>

                <div class="tool-card" onclick="openTool('color')">
                    <span class="material-symbols-outlined tool-icon">palette</span>
                    <div class="tool-info">
                        <h3>Color Tool</h3>
                        <p>Visualizzatore EBC/SRM/Lovibond.</p>
                    </div>
                </div>



                <div class="tool-card" onclick="openTool('spillatura')">
                    <span class="icon-tap tool-icon"></span> 
                    <div class="tool-info">
                        <h3>Valori Spillatura</h3>
                        <p>Consigli Pressione/Temp per stile.</p>
                    </div>
                </div>

                <div class="tool-card" onclick="openTool('quiz')">
                    <span class="material-symbols-outlined tool-icon">school</span>
                    <div class="tool-info">
                        <h3>Beer Quiz</h3>
                        <p>Mettiti alla prova sulla cultura birraria.</p>
                    </div>
                </div>

            </div>
        </div>

        <div id="view-converter" class="tool-container" style="display: none;">
            <div class="tool-box">
                <h4 class="tool-header"><span class="material-symbols-outlined">scale</span> Gravità</h4>
                <div class="conv-grid">
                    <div class="conv-item"><label>SG (1.xxx)</label><input type="number" id="grav-sg" placeholder="1.050" step="0.001"></div>
                    <div class="conv-item"><label>Plato (°P)</label><input type="number" id="grav-plato" placeholder="12.4" step="0.1"></div>
                </div>
            </div>
            <div class="tool-box">
                <h4 class="tool-header"><span class="material-symbols-outlined">local_bar</span> Volume Servizio</h4>
                <div class="conv-grid">
                    <div class="conv-item"><label>Centilitri (cl)</label><input type="number" id="serv-cl" placeholder="33"></div>
                    <div class="conv-item"><label>Litri (l)</label><input type="number" id="serv-l" placeholder="0.33"></div>
                    <div class="conv-item"><label>Pinta UK (568ml)</label><input type="number" id="serv-pint-uk" placeholder="1"></div>
                    <div class="conv-item"><label>Mezza Pinta UK (284ml)</label><input type="number" id="serv-half-uk" placeholder="2"></div>
                    <div class="conv-item"><label>Pinta USA (473ml)</label><input type="number" id="serv-pint-us" placeholder="1"></div>
                    <div class="conv-item"><label>Oncia Fluida (29.6ml)</label><input type="number" id="serv-floz" placeholder="12"></div>
                </div>
            </div>
            <div class="tool-box">
                <h4 class="tool-header"><span class="material-symbols-outlined">factory</span> Volume Produzione</h4>
                <div class="conv-grid">
                    <div class="conv-item"><label>Litri (l)</label><input type="number" id="prod-l" placeholder="23"></div>
                    <div class="conv-item"><label>Ettolitri (hl)</label><input type="number" id="prod-hl" placeholder="0.23"></div>
                    <div class="conv-item"><label>Galloni USA</label><input type="number" id="prod-gal-us" placeholder="6"></div>
                    <div class="conv-item"><label>Galloni UK</label><input type="number" id="prod-gal-uk" placeholder="5"></div>
                    <div class="conv-item"><label>Barili USA (BBL)</label><input type="number" id="prod-bbl" placeholder="0.19"></div>
                </div>
            </div>
            <div class="tool-box">
                <h4 class="tool-header"><span class="material-symbols-outlined">speed</span> Pressione</h4>
                <div class="conv-grid">
                    <div class="conv-item"><label>Bar</label><input type="number" id="pres-bar" placeholder="2.0"></div>
                    <div class="conv-item"><label>PSI</label><input type="number" id="pres-psi" placeholder="29"></div>
                    <div class="conv-item"><label>Atm</label><input type="number" id="pres-atm" placeholder="1.9"></div>
                </div>
            </div>
            <div class="tool-box">
                <h4 class="tool-header"><span class="material-symbols-outlined">thermostat</span> Temperatura</h4>
                <div class="conv-grid">
                    <div class="conv-item"><label>Celsius (°C)</label><input type="number" id="temp-c" placeholder="20"></div>
                    <div class="conv-item"><label>Fahrenheit (°F)</label><input type="number" id="temp-f" placeholder="68"></div>
                </div>
            </div>
            <div class="tool-box">
                <h4 class="tool-header"><span class="material-symbols-outlined">palette</span> Colore</h4>
                <div class="conv-grid">
                    <div class="conv-item"><label>SRM</label><input type="number" id="col-srm" placeholder="5"></div>
                    <div class="conv-item"><label>EBC</label><input type="number" id="col-ebc" placeholder="10"></div>
                    <div class="conv-item"><label>Lovibond (°L)</label><input type="number" id="col-lov" placeholder="4"></div>
                </div>
            </div>
        </div>

        <div id="view-color" class="tool-container" style="display: none;">
            <div class="tool-box" style="text-align: center;">
                <div id="beer-glass-preview"></div>
                <h3 id="color-desc" style="color: var(--primary-color); margin: 10px 0;">Giallo Paglierino</h3>
                <div class="color-values">
                    <div class="color-val-box"><label>SRM</label><span id="val-srm">1</span></div>
                    <div class="color-val-box"><label>EBC</label><span id="val-ebc">2</span></div>
                    <div class="color-val-box"><label>Lovibond</label><span id="val-lov">1.3</span>°L</div>
                </div>
                <div style="padding: 0 10px;">
                    <input type="range" id="color-slider" min="1" max="50" value="1" step="0.1">
                    <div style="display:flex; justify-content:space-between; margin-top:5px; color:#6b7280; font-size:0.8rem;">
                        <span>Chiara</span><span>Scura</span>
                    </div>
                </div>
            </div>
        </div>

        <div id="view-spillatura" class="tool-container" style="display: none; text-align: center; padding: 40px;">
            <span class="icon-tap" style="font-size: 4rem; color: #f59e0b; margin-bottom: 20px; display:block;"></span>
            <h3>Valori Spillatura</h3>
            <p style="color: var(--text-muted);">Consigli su pressione e temperatura.<br>In arrivo nel prossimo aggiornamento!</p>
        </div>

        <div id="view-quiz" class="tool-container" style="display: none; text-align: center; padding: 40px;">
            <span class="material-symbols-outlined" style="font-size: 4rem; color: #f59e0b; margin-bottom: 20px;">school</span>
            <h3>Beer Quiz</h3>
            <p style="color: var(--text-muted);">Mettiti alla prova!<br>In arrivo nel prossimo aggiornamento.</p>
        </div>

    </div>

    <footer style="text-align: center; margin-top: 40px; font-size: 1rem; color: #4b5563;">
        &copy; 2026 Beer Tasting Club <span class="footer-ver" id="footer-version">v...</span><br>
        <a href="privacy.html" style="color: inherit; text-decoration: underline;">Info Privacy e Cookie</a>
        <p style="text-align: center; margin-top: 5px; font-size: 0.7rem; color: #4b5563; display: flex; align-items: center; justify-content: center; gap: 4px;">
            Crafted with love by <a href="https://www.linkedin.com/in/mirko-caiani/" target="_blank" style="color: inherit; text-decoration: underline;">Mirko Caiani</a>
        </p>
    </footer>

    <div id="update-toast" class="update-toast">
        <span class="material-symbols-outlined">system_update</span>
        Nuova versione! Clicca qui.
    </div>

    <script type="module">
        import { APP_VERSION } from './js/config.js';

        document.getElementById('footer-version').textContent = ` v${APP_VERSION}`;

        // TASTO HOME
        document.getElementById('dynamic-back-btn').onclick = () => window.location.href = 'index.html';

        // NAVIGAZIONE STRUMENTI
        window.openTool = function (toolName) {
            // Nota: 'bjcp' è stato rimosso dalla logica interna perché ora è un link esterno
            ['menu', 'converter', 'color', 'spillatura', 'quiz'].forEach(v => document.getElementById(`view-${v}`).style.display = 'none');
            
            const target = document.getElementById(`view-${toolName}`);
            if(target) {
                target.style.display = 'block';
                const titleMap = {
                    'converter': 'Convertitore', 'color': 'Color Tool',
                    'spillatura': 'Valori Spillatura', 'quiz': 'Beer Quiz'
                };
                document.getElementById('page-title').textContent = titleMap[toolName];
                document.getElementById('page-subtitle').style.display = 'none';
                
                const backBtn = document.getElementById('dynamic-back-btn');
                document.getElementById('back-label').textContent = 'Strumenti';
                backBtn.onclick = () => showMenu();
            }
        }

        window.showMenu = function () {
            ['converter', 'color', 'spillatura', 'quiz'].forEach(v => document.getElementById(`view-${v}`).style.display = 'none');
            document.getElementById('view-menu').style.display = 'block';
            document.getElementById('page-title').textContent = 'Strumenti';
            document.getElementById('page-subtitle').style.display = 'block';
            const backBtn = document.getElementById('dynamic-back-btn');
            document.getElementById('back-label').textContent = 'Home';
            backBtn.onclick = () => window.location.href = 'index.html';
        }

        /* --- LOGICA CONVERTITORE --- */
        let isCalculating = false;

        // 1. GRAVITA'
        const g_sg = document.getElementById('grav-sg'), g_plato = document.getElementById('grav-plato');
        g_sg.addEventListener('input', () => { if(isCalculating)return; isCalculating=true; const v=parseFloat(g_sg.value); g_plato.value=!isNaN(v)?((v-1)*1000/4).toFixed(2):''; isCalculating=false; });
        g_plato.addEventListener('input', () => { if(isCalculating)return; isCalculating=true; const v=parseFloat(g_plato.value); g_sg.value=!isNaN(v)?(1+(v/(258.6-((v/258.2)*227.1)))).toFixed(3):''; isCalculating=false; });

        // 2. SERVIZIO
        const s_inputs = { cl: document.getElementById('serv-cl'), l: document.getElementById('serv-l'), pint_uk: document.getElementById('serv-pint-uk'), half_uk: document.getElementById('serv-half-uk'), pint_us: document.getElementById('serv-pint-us'), floz: document.getElementById('serv-floz') };
        const s_factors = { l:1, cl:0.01, pint_uk:0.568261, half_uk:0.284131, pint_us:0.473176, floz:0.0295735 };
        
        function updateServVol(src) {
            if(isCalculating)return; isCalculating=true; const val=parseFloat(s_inputs[src].value);
            if(isNaN(val)){ Object.values(s_inputs).forEach(el=>el.value=''); isCalculating=false; return; }
            const liters = val * s_factors[src];
            Object.keys(s_inputs).forEach(k => { if(k!==src) s_inputs[k].value = (liters / s_factors[k]).toFixed(k==='l'||k==='cl'?2:2); });
            isCalculating=false;
        }
        Object.keys(s_inputs).forEach(k => s_inputs[k].addEventListener('input', () => updateServVol(k)));

        // 3. PRODUZIONE & 4. PRESSIONE & 5. TEMP (Logica ridotta per brevità, identica a prima)
        // ... (Mantengo la logica originale funzionante) ...
        const p_inputs = { l: document.getElementById('prod-l'), hl: document.getElementById('prod-hl'), gal_us: document.getElementById('prod-gal-us'), gal_uk: document.getElementById('prod-gal-uk'), bbl: document.getElementById('prod-bbl') };
        const p_factors = { l:1, hl:100, gal_us:3.78541, gal_uk:4.54609, bbl:117.347 };
        function updateProd(src) { if(isCalculating)return; isCalculating=true; const v=parseFloat(p_inputs[src].value); if(isNaN(v)){Object.values(p_inputs).forEach(e=>e.value=''); isCalculating=false; return;} const l=v*p_factors[src]; Object.keys(p_inputs).forEach(k=>{if(k!==src)p_inputs[k].value=(l/p_factors[k]).toFixed(2)}); isCalculating=false; }
        Object.keys(p_inputs).forEach(k=>p_inputs[k].addEventListener('input',()=>updateProd(k)));

        const pr_inputs = { bar: document.getElementById('pres-bar'), psi: document.getElementById('pres-psi'), atm: document.getElementById('pres-atm') };
        function updatePres(src) { if(isCalculating)return; isCalculating=true; const v=parseFloat(pr_inputs[src].value); if(isNaN(v)){Object.values(pr_inputs).forEach(e=>e.value=''); isCalculating=false; return;} let b=0; if(src==='bar')b=v; else if(src==='psi')b=v/14.5038; else b=v/0.986923; if(src!=='bar')pr_inputs.bar.value=b.toFixed(2); if(src!=='psi')pr_inputs.psi.value=(b*14.5038).toFixed(1); if(src!=='atm')pr_inputs.atm.value=(b*0.986923).toFixed(2); isCalculating=false; }
        Object.keys(pr_inputs).forEach(k=>pr_inputs[k].addEventListener('input',()=>updatePres(k)));

        const t_c=document.getElementById('temp-c'), t_f=document.getElementById('temp-f');
        t_c.addEventListener('input', ()=>{if(isCalculating)return; isCalculating=true; const v=parseFloat(t_c.value); t_f.value=!isNaN(v)?((v*9/5)+32).toFixed(1):''; isCalculating=false;});
        t_f.addEventListener('input', ()=>{if(isCalculating)return; isCalculating=true; const v=parseFloat(t_f.value); t_c.value=!isNaN(v)?((v-32)*5/9).toFixed(1):''; isCalculating=false;});

        // 6. COLORE
        const c_srm=document.getElementById('col-srm'), c_ebc=document.getElementById('col-ebc'), c_lov=document.getElementById('col-lov');
        function updateColText(src) { if(isCalculating)return; isCalculating=true; const v=parseFloat(document.getElementById(`col-${src}`).value); if(isNaN(v)){[c_srm,c_ebc,c_lov].forEach(e=>e.value='');isCalculating=false;return;} let s=0; if(src==='srm')s=v; else if(src==='ebc')s=v/1.97; else s=(1.3546*v)-0.76; if(src!=='srm')c_srm.value=s.toFixed(1); if(src!=='ebc')c_ebc.value=(s*1.97).toFixed(1); if(src!=='lov')c_lov.value=((s+0.76)/1.3546).toFixed(1); isCalculating=false; }
        ['srm','ebc','lov'].forEach(k=>document.getElementById(`col-${k}`).addEventListener('input',()=>updateColText(k)));

        /* --- VISUAL COLOR --- */
        const refPoints = [{srm:1,hex:[240,238,188]},{srm:2,hex:[233,214,125]},{srm:4,hex:[220,178,54]},{srm:5,hex:[213,164,53]},{srm:7,hex:[200,139,45]},{srm:9,hex:[187,117,49]},{srm:13,hex:[167,88,46]},{srm:17,hex:[152,70,38]},{srm:22,hex:[129,49,36]},{srm:27,hex:[104,37,25]},{srm:34,hex:[80,17,19]},{srm:40,hex:[49,18,20]},{srm:50,hex:[0,0,0]}];
        function getColorForSRM(srm) {
            if(srm<=1)return `rgb(${refPoints[0].hex.join(',')})`; if(srm>=50)return `rgb(${refPoints[refPoints.length-1].hex.join(',')})`;
            let prev=refPoints[0], next=refPoints[refPoints.length-1];
            for(let i=0;i<refPoints.length-1;i++){if(srm>=refPoints[i].srm && srm<=refPoints[i+1].srm){prev=refPoints[i];next=refPoints[i+1];break;}}
            const range=next.srm-prev.srm, dist=srm-prev.srm, ratio=dist/range;
            const r=Math.round(prev.hex[0]+(next.hex[0]-prev.hex[0])*ratio), g=Math.round(prev.hex[1]+(next.hex[1]-prev.hex[1])*ratio), b=Math.round(prev.hex[2]+(next.hex[2]-prev.hex[2])*ratio);
            return `rgb(${r},${g},${b})`;
        }
        function getDescForSRM(srm) { if(srm<2)return "Giallo Paglierino"; if(srm<4)return "Giallo Pallido"; if(srm<7)return "Giallo Dorato"; if(srm<12)return "Ambrato"; if(srm<18)return "Ambrato Scuro / Ramato"; if(srm<25)return "Marrone"; if(srm<35)return "Marrone Scuro"; if(srm<40)return "Marrone Molto Scuro"; return "Nero"; }
        
        document.getElementById('color-slider').addEventListener('input', (e)=>{
            const srm=parseFloat(e.target.value);
            document.getElementById('val-srm').textContent=srm.toFixed(1);
            document.getElementById('val-ebc').textContent=(srm*1.97).toFixed(1);
            document.getElementById('val-lov').textContent=((srm+0.76)/1.3546).toFixed(1);
            document.getElementById('color-desc').textContent=getDescForSRM(srm);
            document.getElementById('beer-glass-preview').style.backgroundColor=getColorForSRM(srm);
        });

        // SW
        const updateToast = document.getElementById('update-toast');
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('./sw.js').then(reg => {
                const trackInstalling = (worker) => {
                    worker.addEventListener('statechange', () => {
                        if (worker.state === 'installed' && navigator.serviceWorker.controller && updateToast) updateToast.classList.add('show');
                    });
                };
                if (reg.waiting && updateToast) updateToast.classList.add('show');
                else if (reg.installing) trackInstalling(reg.installing);
                reg.addEventListener('updatefound', () => trackInstalling(reg.installing));
            });
        }
        if (updateToast) updateToast.addEventListener('click', () => window.location.reload());
    </script>
</body>
</html>