<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tools & Utility - Beer Tasting Club</title>
    <link rel="stylesheet" href="css/style.css?v=0.8.5">
    <link rel="manifest" href="/Beer-Tasting-Club/manifest.json">
    <meta name="theme-color" content="#f59e0b">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <link rel="icon" type="image/png" href="assets/icon-192.png">
    <link rel="apple-touch-icon" href="assets/icon-192.png">
    <style>
        /* GRID MENU STRUMENTI */
        .tools-grid { display: grid; grid-template-columns: 1fr; gap: 15px; margin-top: 20px; }
        .tool-card { background: #1f2937; border: 1px solid #374151; border-radius: 12px; padding: 20px; display: flex; align-items: center; gap: 15px; cursor: pointer; transition: transform 0.2s, border-color 0.2s; }
        .tool-card:active { transform: scale(0.98); }
        .tool-card:hover { border-color: var(--primary-color); }
        .tool-icon { font-size: 2.5rem; color: var(--primary-color); background: rgba(245, 158, 11, 0.1); padding: 10px; border-radius: 50%; }
        .tool-info h3 { margin: 0; color: #fff; font-size: 1.1rem; }
        .tool-info p { margin: 5px 0 0 0; color: var(--text-muted); font-size: 0.9rem; }

        /* BOX GENERICO TOOL */
        .tool-container { margin-top: 20px; animation: fadeIn 0.3s ease-out; }
        .tool-box { background: #111827; padding: 15px; border-radius: 8px; border: 1px solid #374151; margin-bottom: 20px; }
        
        /* TITOLI SEZIONI INTERNE */
        .tool-header { display: flex; align-items: center; gap: 10px; margin-top: 0; margin-bottom: 15px; color: #d1d5db; font-size: 1.1rem; border-bottom: 1px solid #374151; padding-bottom: 10px; }
        .tool-header span { color: var(--primary-color); }

        /* STILI CONVERTITORE */
        .conv-row { display: flex; gap: 10px; align-items: center; margin-bottom: 10px; }
        .conv-input { flex: 1; padding: 10px; border-radius: 6px; border: 1px solid #4b5563; background: #1f2937; color: white; font-size: 1.1rem; text-align: center; }
        .conv-select { flex: 1; padding: 10px; border-radius: 6px; border: 1px solid #4b5563; background: #1f2937; color: white; }

        /* STILI COLOR TOOL */
        #beer-glass-preview {
            width: 120px; height: 160px;
            margin: 20px auto;
            border: 2px solid rgba(255,255,255,0.2);
            border-radius: 0 0 15px 15px;
            border-top: none;
            background-color: #F8F4C4; /* Default */
            box-shadow: 0 0 20px rgba(0,0,0,0.5) inset;
            transition: background-color 0.2s;
            position: relative;
        }
        /* Schiuma */
        #beer-glass-preview::before {
            content: ''; position: absolute; top: -10px; left: 0; width: 100%; height: 20px;
            background: white; border-radius: 5px 5px 0 0; opacity: 0.9;
        }
        .color-values { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 10px; margin-bottom: 20px; }
        .color-val-box { text-align: center; background: #1f2937; padding: 10px; border-radius: 6px; border: 1px solid #374151; }
        .color-val-box label { display: block; color: var(--text-muted); font-size: 0.8rem; margin-bottom: 5px; }
        .color-val-box span { font-size: 1.2rem; font-weight: bold; color: white; }
        
        /* Slider Custom */
        input[type=range] { -webkit-appearance: none; appearance: none; width: 100%; background: transparent; cursor: pointer; }
        input[type=range]::-webkit-slider-runnable-track { width: 100%; height: 8px; background: linear-gradient(to right, #F8F4C4, #D88229, #672E16, #180D08); border-radius: 4px; }
        input[type=range]::-webkit-slider-thumb { -webkit-appearance: none; appearance: none; height: 24px; width: 24px; border-radius: 50%; background: white; margin-top: -8px; box-shadow: 0 2px 5px black; border: 2px solid var(--primary-color); }
    </style>
</head>
<body>
    <div class="container">
        
        <div class="header-bar">
            <div id="dynamic-back-btn" class="header-link" style="cursor: pointer;">
                <span class="material-symbols-outlined">arrow_back</span> <span id="back-label">Home</span>
            </div>
            <img src="assets/logo.png" alt="Logo" class="header-logo">
        </div>

        <h2 class="text-center" id="page-title" style="margin-bottom: 5px;">Strumenti</h2>
        <p class="text-center" id="page-subtitle" style="color: var(--text-muted); font-size: 0.9em; margin-top:0;">Utility per Homebrewer e Giudici</p>

        <div id="view-menu">
            <div class="tools-grid">
                
                <div class="tool-card" onclick="openTool('converter')">
                    <span class="material-symbols-outlined tool-icon">calculate</span>
                    <div class="tool-info">
                        <h3>Convertitore</h3>
                        <p>Unità di misura (Temp, Gravità, Vol).</p>
                    </div>
                </div>

                <div class="tool-card" onclick="openTool('color')">
                    <span class="material-symbols-outlined tool-icon">palette</span>
                    <div class="tool-info">
                        <h3>Color Tool</h3>
                        <p>Visualizzatore EBC/SRM/Lovibond.</p>
                    </div>
                </div>

                <div class="tool-card" onclick="openTool('bjcp')">
                    <span class="material-symbols-outlined tool-icon">analytics</span>
                    <div class="tool-info">
                        <h3>BJCP Vitals</h3>
                        <p>Dati tecnici e range per ogni stile.</p>
                    </div>
                </div>

                <div class="tool-card" onclick="openTool('quiz')">
                    <span class="material-symbols-outlined tool-icon">school</span>
                    <div class="tool-info">
                        <h3>Beer Quiz</h3>
                        <p>Mettiti alla prova sulla cultura birraria.</p>
                    </div>
                </div>

            </div>
        </div>

        <div id="view-converter" class="tool-container" style="display: none;">
            
            <div class="tool-box">
                <h4 class="tool-header"><span class="material-symbols-outlined">thermostat</span> Temperatura</h4>
                <div class="conv-row">
                    <input type="number" id="temp-in" class="conv-input" placeholder="0">
                    <select id="temp-unit-in" class="conv-select"><option value="c">°C</option><option value="f">°F</option></select>
                </div>
                <div style="text-align:center; color:#6b7280; margin-bottom: 10px;"><span class="material-symbols-outlined">arrow_downward</span></div>
                <div class="conv-row">
                    <input type="number" id="temp-out" class="conv-input" readonly>
                    <select id="temp-unit-out" class="conv-select"><option value="f">°F</option><option value="c">°C</option></select>
                </div>
            </div>

            <div class="tool-box">
                <h4 class="tool-header"><span class="material-symbols-outlined">scale</span> Gravità</h4>
                <div class="conv-row">
                    <input type="number" id="grav-in" class="conv-input" placeholder="1.050" step="0.001">
                    <select id="grav-unit-in" class="conv-select"><option value="sg">SG</option><option value="plato">°P</option></select>
                </div>
                <div style="text-align:center; color:#6b7280; margin-bottom: 10px;"><span class="material-symbols-outlined">arrow_downward</span></div>
                <div class="conv-row">
                    <input type="number" id="grav-out" class="conv-input" readonly>
                    <select id="grav-unit-out" class="conv-select"><option value="plato">°P</option><option value="sg">SG</option></select>
                </div>
            </div>

            <div class="tool-box">
                <h4 class="tool-header"><span class="material-symbols-outlined">water_drop</span> Volume</h4>
                <div class="conv-row">
                    <input type="number" id="vol-in" class="conv-input" placeholder="23">
                    <select id="vol-unit-in" class="conv-select"><option value="l">Litri</option><option value="gal">Galloni</option></select>
                </div>
                <div style="text-align:center; color:#6b7280; margin-bottom: 10px;"><span class="material-symbols-outlined">arrow_downward</span></div>
                <div class="conv-row">
                    <input type="number" id="vol-out" class="conv-input" readonly>
                    <select id="vol-unit-out" class="conv-select"><option value="gal">Galloni</option><option value="l">Litri</option></select>
                </div>
            </div>
        </div>

        <div id="view-color" class="tool-container" style="display: none;">
            <div class="tool-box" style="text-align: center;">
                <div id="beer-glass-preview"></div>
                
                <h3 id="color-desc" style="color: var(--primary-color); margin: 10px 0;">Giallo Paglierino</h3>
                
                <div class="color-values">
                    <div class="color-val-box">
                        <label>SRM</label>
                        <span id="val-srm">2</span>
                    </div>
                    <div class="color-val-box">
                        <label>EBC</label>
                        <span id="val-ebc">4</span>
                    </div>
                    <div class="color-val-box">
                        <label>Lovibond</label>
                        <span id="val-lov">1.7</span>°L
                    </div>
                </div>

                <div style="padding: 0 10px;">
                    <input type="range" id="color-slider" min="1" max="40" value="2" step="0.5">
                    <div style="display:flex; justify-content:space-between; margin-top:5px; color:#6b7280; font-size:0.8rem;">
                        <span>Chiara</span><span>Scura</span>
                    </div>
                </div>
            </div>
        </div>

        <div id="view-bjcp" class="tool-container" style="display: none; text-align: center; padding: 40px;">
            <span class="material-symbols-outlined" style="font-size: 4rem; color: #f59e0b; margin-bottom: 20px;">analytics</span>
            <h3>BJCP Vitals</h3>
            <p style="color: var(--text-muted);">Database stili e range tecnici.<br>In arrivo nel prossimo aggiornamento!</p>
        </div>

        <div id="view-quiz" class="tool-container" style="display: none; text-align: center; padding: 40px;">
            <span class="material-symbols-outlined" style="font-size: 4rem; color: #f59e0b; margin-bottom: 20px;">school</span>
            <h3>Beer Quiz</h3>
            <p style="color: var(--text-muted);">Mettiti alla prova!<br>In arrivo nel prossimo aggiornamento.</p>
        </div>

    </div>

    <footer style="text-align: center; margin-top: 40px; font-size: 1rem; color: #4b5563;">
        &copy; 2026 Beer Tasting Club <span class="footer-ver" id="footer-version">v...</span>
    </footer>

    <div id="update-toast" class="update-toast">
        <span class="material-symbols-outlined">system_update</span>
        Nuova versione! Clicca qui.
    </div>

    <script type="module">
        import { APP_VERSION } from './js/config.js';

        // 1. Version
        document.getElementById('footer-version').textContent = ` v${APP_VERSION}`;

        // 2. NAV & ROUTING LOGIC
        window.openTool = function(toolName) {
            ['menu', 'converter', 'color', 'bjcp', 'quiz'].forEach(v => document.getElementById(`view-${v}`).style.display = 'none');
            document.getElementById(`view-${toolName}`).style.display = 'block';

            const titleMap = { 'converter': 'Convertitore', 'bjcp': 'BJCP Vitals', 'color': 'Color Tool', 'quiz': 'Beer Quiz' };
            document.getElementById('page-title').textContent = titleMap[toolName];
            document.getElementById('page-subtitle').style.display = 'none';

            const backBtn = document.getElementById('dynamic-back-btn');
            document.getElementById('back-label').textContent = 'Strumenti';
            backBtn.onclick = () => showMenu();
        }

        window.showMenu = function() {
            ['converter', 'color', 'bjcp', 'quiz'].forEach(v => document.getElementById(`view-${v}`).style.display = 'none');
            document.getElementById('view-menu').style.display = 'block';
            document.getElementById('page-title').textContent = 'Strumenti';
            document.getElementById('page-subtitle').style.display = 'block';
            const backBtn = document.getElementById('dynamic-back-btn');
            document.getElementById('back-label').textContent = 'Home';
            backBtn.onclick = () => window.location.href = 'index.html';
        }

        // 3. LOGICA CONVERTITORE
        function convertTemp() {
            const val = parseFloat(document.getElementById('temp-in').value);
            const unitIn = document.getElementById('temp-unit-in').value;
            const resField = document.getElementById('temp-out');
            const unitOut = document.getElementById('temp-unit-out');
            if(unitIn === 'c') unitOut.value = 'f'; else unitOut.value = 'c';
            if (isNaN(val)) { resField.value = ''; return; }
            resField.value = (unitIn === 'c' ? (val * 9/5) + 32 : (val - 32) * 5/9).toFixed(1);
        }

        function convertGrav() {
            const val = parseFloat(document.getElementById('grav-in').value);
            const unitIn = document.getElementById('grav-unit-in').value;
            const resField = document.getElementById('grav-out');
            const unitOut = document.getElementById('grav-unit-out');
            if(unitIn === 'sg') unitOut.value = 'plato'; else unitOut.value = 'sg';
            if (isNaN(val)) { resField.value = ''; return; }
            if (unitIn === 'sg') resField.value = ((val - 1) * 1000 / 4).toFixed(2);
            else resField.value = (1 + (val / (258.6 - ((val/258.2)*227.1)))).toFixed(3);
        }

        function convertVol() {
            const val = parseFloat(document.getElementById('vol-in').value);
            const unitIn = document.getElementById('vol-unit-in').value;
            const resField = document.getElementById('vol-out');
            const unitOut = document.getElementById('vol-unit-out');
            if(unitIn === 'l') unitOut.value = 'gal'; else unitOut.value = 'l';
            if (isNaN(val)) { resField.value = ''; return; }
            resField.value = (unitIn === 'l' ? val * 0.264172 : val * 3.78541).toFixed(2);
        }

        ['keyup', 'change'].forEach(evt => {
            document.getElementById('temp-in').addEventListener(evt, convertTemp);
            document.getElementById('temp-unit-in').addEventListener(evt, convertTemp);
            document.getElementById('grav-in').addEventListener(evt, convertGrav);
            document.getElementById('grav-unit-in').addEventListener(evt, convertGrav);
            document.getElementById('vol-in').addEventListener(evt, convertVol);
            document.getElementById('vol-unit-in').addEventListener(evt, convertVol);
        });

        // 4. LOGICA COLOR TOOL
        const colorMap = [
            { srm: 2, hex: '#F8F4C4', desc: 'Giallo Paglierino' },
            { srm: 3, hex: '#F6EB38', desc: 'Giallo' },
            { srm: 4, hex: '#F3D231', desc: 'Dorato' },
            { srm: 6, hex: '#D88229', desc: 'Ambrato' },
            { srm: 9, hex: '#C76822', desc: 'Ambrato Carico' },
            { srm: 12, hex: '#A84C19', desc: 'Ramato' },
            { srm: 15, hex: '#8F3916', desc: 'Marrone Chiaro' },
            { srm: 20, hex: '#672E16', desc: 'Marrone' },
            { srm: 24, hex: '#481F11', desc: 'Marrone Scuro' },
            { srm: 30, hex: '#2F130D', desc: 'Marrone Molto Scuro' },
            { srm: 40, hex: '#180D08', desc: 'Nero' }
        ];

        function updateColor() {
            const srm = parseFloat(document.getElementById('color-slider').value);
            const ebc = (srm * 1.97).toFixed(1);
            // Formula Lovibond approx: (°L = (SRM + 0.76) / 1.3546)
            const lov = ((srm + 0.76) / 1.3546).toFixed(1);
            
            // Trova il colore più vicino nell'array
            let closest = colorMap[0];
            let minDiff = Infinity;
            
            colorMap.forEach(c => {
                const diff = Math.abs(c.srm - srm);
                if(diff < minDiff) { minDiff = diff; closest = c; }
            });

            document.getElementById('val-srm').textContent = srm;
            document.getElementById('val-ebc').textContent = ebc;
            document.getElementById('val-lov').textContent = lov;
            document.getElementById('color-desc').textContent = closest.desc;
            document.getElementById('beer-glass-preview').style.backgroundColor = closest.hex;
        }

        document.getElementById('color-slider').addEventListener('input', updateColor);

        // 5. SW UPDATE
        const updateToast = document.getElementById('update-toast');
        if ('serviceWorker' in navigator) navigator.serviceWorker.register('./sw.js').then(reg => { if (reg.waiting && updateToast) updateToast.classList.add('show'); reg.addEventListener('updatefound', () => { const n = reg.installing; n.addEventListener('statechange', () => { if (n.state === 'installed' && navigator.serviceWorker.controller && updateToast) updateToast.classList.add('show'); }); }); });
        if(updateToast) updateToast.addEventListener('click', () => window.location.reload());
    </script>
</body>
</html>